<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WASM Plugin in Browser</title>
</head>

<body>

    <!-- You can add some basic input fields and a button to trigger the function -->
    <input id="url" placeholder="Enter WASM file URL" value="http://127.0.0.1:5500/wasm/hello.wasm" />
    <input id="funcname" placeholder="Enter function name" value="run_test" />
    <input id="inputText" placeholder="Enter input" value="this is a test" />
    <button id="runButton">Run</button>

    <script type="module">
        import { ExtismPlugin, PluginOptions } from "/dist/browser/index.esm.js";

        async function runPlugin() {
            // Get values from input fields
            const url = document.getElementById('url').value;
            const funcname = document.getElementById('funcname').value;
            const input = document.getElementById('inputText').value || "this is a test";

            const wasm = {
                url: url
            }

            const options = new PluginOptions()
                .withConfig("thing", "testing")
                .withRuntime({
                    url: "/wasm/extism-runtime.wasm"
                })
                .withWasi();

            const plugin = await ExtismPlugin.newPlugin(wasm, options);

            const res = await plugin.call(funcname, new TextEncoder().encode(input));
            const s = new TextDecoder().decode(res.buffer);
            console.log(s)
        }

        // Attach the event listener inside the module
        document.getElementById('runButton').addEventListener('click', runPlugin);
    </script>

</body>

</html>